<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
	</head>
	<body>
		<input type="file" name="file" id="file" />
		<div id="">
			<img class="tp" src=""/>
		</div>
	</body>
	<script src="jquery-1.8.3.js" type="text/javascript" charset="utf-8"></script>
    <script src="spark-md5.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="async.js" type="text/javascript" charset="utf-8"></script>
	<script src="upyun-mu.js"></script>
	<script type="text/javascript">
		var pub = {
			addLog:function(data){
				console.log(data);
				pub.src=data.bucket_name+".b0.upaiyun.com"+data.path;
				//pub.person.heade_pic()
			},
			
		}
		$("#file").on('change',function(){
			var tar = this,
			files = tar.files,
			fNum = files.length,
			URL = window.URL || window.webkitURL;
			if(!files[0])return;
			console.log(this)
			for(var i=0;i<fNum;i++){
				if(files[i].type.search(/image/)>=0){
					var blob = URL.createObjectURL(files[i]);
					document.getElementsByClassName('tp')[0].src=blob;
				}
			};
			var ext = '.' + document.getElementById('file').files[0].name.split('.').pop();
			var config = {
				bucket: 'zhangshuoinfo',
				expiration: parseInt((new Date().getTime() + 3600000) / 1000),
				// 尽量不要使用直接传表单 API 的方式，以防泄露造成安全隐患
				form_api_secret: 'LaubRPoyoLzq9tJ82/z+RSmFUVY='
			};
			var instance = new Sand(config);
			var options = {
				'notify_url': 'http://zhangshuoinfo.b0.upaiyun.com'
			};
			instance.setOptions(options);
			instance.upload( + parseInt((new Date().getTime() + 3600000) / 1000) + ext);
		});
		document.addEventListener('uploaded', function(e) {
			pub.addLog(e.detail);
		});
	</script>
</html>
